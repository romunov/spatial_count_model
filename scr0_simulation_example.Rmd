---
title: "SCR0 simulation example"
author: "Roman Lu≈°trik"
date: "22. avgust 2015"
output: html_document
---

On page 482 of the SCR book by Royle et al (2014) lies this example:
```{r}
library(scrbook)
```

```{r}
# glej stran 140
tr <- seq(5, 25, length = 5)

# create trap grid
X <- expand.grid(x = tr, y = tr)

plot(X, xlim = c(0, 30), ylim = c(0, 30), asp = 1)

# number of traps
J <- nrow(X)

# define state space for individuals
buffer <- 2
xlim <- range(X[, 1]) + c(-buffer, buffer)
ylim <- range(X[, 2]) + c(-buffer, buffer)

N <- 75
K <- 5

# simulate activity centers
S <- cbind(x = runif(N, xlim[1], xlim[2]),
           y = runif(N, ylim[1], ylim[2]))

points(S, col = "red", cex = 0.5)

p0 <- -2.5
sigma <- 3

# prepare for sampling
y <- array(0, c(N, J, K))
for (j in 1:J) {
  dist <- sqrt((X[j, 1] - S[, 1])^2 + (X[j, 2] - S[, 2])^2)
  p <- plogis(p0) * exp(-dist^2/(2*sigma^2))
  for (k in 1:K) {
    y[, j, k] <- rbinom(N, 1, p) 
  }
}

M <- 200
niter <- 20000
```


### Binomial model
```{r fit_binomial}
bin.y <- apply(y, MARGIN = 1:2, FUN = sum)
bin.y <- bin.y[rowSums(bin.y) != 0, ] # remove non-captured individuals
augmented.y <- matrix(0, nrow = M, ncol = ncol(y))
augmented.y[1:nrow(bin.y), ] <- bin.y


mdl.binom <- SCR0binom.cl(y = augmented.y, X = X, M = M, xl = xlim[1],
             xu = xlim[2], yl = ylim[1], yu = ylim[2], K = K, delta = c(0.1, 0.05, 2),
             niter = 5000)
```

```{r analysis}
mc.b <- mcmc(mdl.binom)
plot(mc.b)
mc.b <- window(mc.b, start = 1000)
summary(mc.b)
```



